<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DKR COIN | Unified Savings Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <style>
        :root { --dkr-blue: #38bdf8; --dkr-deep: #0f172a; --dkr-card: #1e293b; }
        body { font-family: 'Inter', sans-serif; background: var(--dkr-deep); color: white; margin: 0; display: flex; align-items: center; justify-content: center; min-height: 100vh; text-align: center; }
        .container { background: var(--dkr-card); padding: 40px; border-radius: 24px; box-shadow: 0 0 40px rgba(56, 189, 248, 0.15); border: 1px solid rgba(56, 189, 248, 0.1); width: 380px; }
        h1 { color: var(--dkr-blue); letter-spacing: 1px; margin-bottom: 5px; }
        p { color: #94a3b8; font-size: 0.9rem; margin-bottom: 25px; }
        input { width: 100%; padding: 12px; margin: 10px 0; border-radius: 12px; border: 1px solid #334155; background: #0f172a; color: white; box-sizing: border-box; text-align: center; font-size: 1.1rem; }
        .btn { background: var(--dkr-blue); color: var(--dkr-deep); border: none; width: 100%; padding: 14px; border-radius: 12px; font-weight: bold; cursor: pointer; transition: 0.2s; margin-top: 10px; }
        .btn:hover { background: #7dd3fc; transform: translateY(-2px); }
        .secondary-btn { background: transparent; color: var(--dkr-blue); border: 1px solid var(--dkr-blue); margin-top: 15px; }
        .status { margin-top: 15px; font-size: 0.8rem; color: #4ade80; line-height: 1.5; word-wrap: break-word; }
        .admin-section { margin-top: 30px; padding-top: 20px; border-top: 1px dashed #334155; }
    </style>
</head>
<body>
    <div class="container">
        <h1>DKR COIN</h1>
        <p>Simplified Multi-Currency Savings</p>
        
        <button id="connectBtn" class="btn">CONNECT WALLET</button>
        <div id="walletAddress" class="status">Waiting for connection...</div>

        <hr style="border: 0.5px solid #334155; margin: 25px 0;">
        
        <label style="font-size: 0.8rem; display: block; text-align: left;">Simulated USD Deposit</label>
        <input type="number" id="usdInput" placeholder="0.00">
        <div style="font-size: 0.9rem; margin: 10px 0;">Receiving: <span id="dkrOutput" style="color: var(--dkr-blue); font-weight: bold;">0.00</span> DKR</div>
        
        <div class="admin-section">
            <p style="color: #f87171; font-size: 0.7rem;">ADMIN TOOLS</p>
            <button id="mintBtn" class="btn secondary-btn">MINT DKR TO WALLET</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            let provider, signer, account, dkrContract;

            // --- YOUR CONFIGURATION ---
            const DKR_CONTRACT_ADDRESS = "0xa423a18a1fd87E8C5e6aE50eA0166041f36eae7E"; 
            const DKR_ABI = [
                "function balanceOf(address owner) view returns (uint256)",
                "function decimals() view returns (uint8)",
                "function issueDKR(address to, uint256 amount) public"
            ];

            const usdInput = document.getElementById('usdInput');
            const dkrOutput = document.getElementById('dkrOutput');
            const connectBtn = document.getElementById('connectBtn');
            const mintBtn = document.getElementById('mintBtn');

            usdInput.addEventListener('input', () => { 
                dkrOutput.innerText = (usdInput.value * 1.25).toFixed(2); 
            });

            connectBtn.onclick = async () => {
                if (typeof window.ethereum !== 'undefined') {
                    try {
                        // Request accounts
                        const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                        account = accounts[0];
                        
                        provider = new ethers.providers.Web3Provider(window.ethereum);
                        signer = provider.getSigner();

                        // Safety check: Validate the contract address format before creating the object
                        if (ethers.utils.isAddress(DKR_CONTRACT_ADDRESS)) {
                            dkrContract = new ethers.Contract(DKR_CONTRACT_ADDRESS, DKR_ABI, signer);
                            connectBtn.innerText = "CONNECTED";
                            updateBalance();
                        } else {
                            alert("The Contract Address in the code is invalid.");
                        }
                    } catch (err) {
                        console.error("User denied account access or error occurred:", err);
                    }
                } else {
                    alert("MetaMask not found! Please install it.");
                }
            };

            async function updateBalance() {
                if (!dkrContract || !account) return;
                try {
                    const balance = await dkrContract.balanceOf(account);
                    const decimals = await dkrContract.decimals();
                    const formatted = ethers.utils.formatUnits(balance, decimals);
                    
                    document.getElementById('walletAddress').innerHTML = 
                        `Wallet: ${account.substring(0,6)}...${account.substring(38)}<br>` +
                        `<strong style="color: var(--dkr-blue)">Balance: ${formatted} DKR</strong>`;
                } catch (e) {
                    console.error("Balance fetch failed. Are you on the right network?", e);
                    document.getElementById('walletAddress').innerText = "Error: Check Network";
                }
            }

            mintBtn.onclick = async () => {
                if (!dkrContract) return alert("Connect Wallet first!");
                const amount = usdInput.value * 1.25;
                if (amount <= 0) return alert("Enter a USD amount.");

                try {
                    mintBtn.innerText = "MINTING...";
                    // Using parseUnits with 0 to match your likely contract setup
                    const tx = await dkrContract.issueDKR(account, ethers.utils.parseUnits(amount.toString(), 0));
                    await tx.wait();
                    alert("Success! DKR Coins added.");
                    updateBalance();
                } catch (err) {
                    console.error(err);
                    alert("Mint failed. Ensure you own the contract and have POL for gas.");
                } finally {
                    mintBtn.innerText = "MINT DKR TO WALLET";
                }
            };
        });
    </script>
</body>
</html>
